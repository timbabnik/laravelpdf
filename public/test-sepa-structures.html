<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <title>SEPA QR Code Structure Tests</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        .qr-code { margin: 10px 0; }
        .description { font-weight: bold; color: #333; }
        .structure { font-family: monospace; background: #f5f5f5; padding: 10px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>SEPA QR Code Structure Tests for Revolut</h1>
    <p>Testing different field orders to find the one that works with Revolut</p>

    <div class="test-section">
        <div class="description">Test 1: Standard EPC (Amount before Currency)</div>
        <div class="structure">
BCD<br>
002<br>
1<br>
SCT<br>
LJBASI2X<br>
Test Company d.o.o.<br>
SI56020313671566113<br>
<strong>5.00</strong><br>
<strong>EUR</strong><br>
<br>
TS-2025-045<br>
Invoice TS-2025-045
        </div>
        <div class="qr-code" id="qr1"></div>
    </div>

    <div class="test-section">
        <div class="description">Test 2: Currency before Amount</div>
        <div class="structure">
BCD<br>
002<br>
1<br>
SCT<br>
LJBASI2X<br>
Test Company d.o.o.<br>
SI56020313671566113<br>
<strong>EUR</strong><br>
<strong>5.00</strong><br>
<br>
TS-2025-045<br>
Invoice TS-2025-045
        </div>
        <div class="qr-code" id="qr2"></div>
    </div>

    <div class="test-section">
        <div class="description">Test 3: Amount with 2 decimal places (5.00)</div>
        <div class="structure">
BCD<br>
002<br>
1<br>
SCT<br>
LJBASI2X<br>
Test Company d.o.o.<br>
SI56020313671566113<br>
<strong>5.00</strong><br>
<strong>EUR</strong><br>
<br>
TS-2025-045<br>
Invoice TS-2025-045
        </div>
        <div class="qr-code" id="qr3"></div>
    </div>

    <div class="test-section">
        <div class="description">Test 4: Amount without decimal (5)</div>
        <div class="structure">
BCD<br>
002<br>
1<br>
SCT<br>
LJBASI2X<br>
Test Company d.o.o.<br>
SI56020313671566113<br>
<strong>5</strong><br>
<strong>EUR</strong><br>
<br>
TS-2025-045<br>
Invoice TS-2025-045
        </div>
        <div class="qr-code" id="qr4"></div>
    </div>

    <div class="test-section">
        <div class="description">Test 5: Amount with 3 decimal places (5.000)</div>
        <div class="structure">
BCD<br>
002<br>
1<br>
SCT<br>
LJBASI2X<br>
Test Company d.o.o.<br>
SI56020313671566113<br>
<strong>5.000</strong><br>
<strong>EUR</strong><br>
<br>
TS-2025-045<br>
Invoice TS-2025-045
        </div>
        <div class="qr-code" id="qr5"></div>
    </div>

    <div class="test-section">
        <div class="description">Test 6: No BIC (domestic transfer)</div>
        <div class="structure">
BCD<br>
002<br>
1<br>
SCT<br>
<br>
Test Company d.o.o.<br>
SI56020313671566113<br>
<strong>5.00</strong><br>
<strong>EUR</strong><br>
<br>
TS-2025-045<br>
Invoice TS-2025-045
        </div>
        <div class="qr-code" id="qr6"></div>
    </div>

    <script>
        // Test 1: Standard EPC (Amount before Currency)
        const test1 = `BCD
002
1
SCT
LJBASI2X
Test Company d.o.o.
SI56020313671566113
5.00
EUR

TS-2025-045
Invoice TS-2025-045`;

        // Test 2: Currency before Amount
        const test2 = `BCD
002
1
SCT
LJBASI2X
Test Company d.o.o.
SI56020313671566113
EUR
5.00

TS-2025-045
Invoice TS-2025-045`;

        // Test 3: Amount with 2 decimal places
        const test3 = `BCD
002
1
SCT
LJBASI2X
Test Company d.o.o.
SI56020313671566113
5.00
EUR

TS-2025-045
Invoice TS-2025-045`;

        // Test 4: Amount without decimal
        const test4 = `BCD
002
1
SCT
LJBASI2X
Test Company d.o.o.
SI56020313671566113
5
EUR

TS-2025-045
Invoice TS-2025-045`;

        // Test 5: Amount with 3 decimal places
        const test5 = `BCD
002
1
SCT
LJBASI2X
Test Company d.o.o.
SI56020313671566113
5.000
EUR

TS-2025-045
Invoice TS-2025-045`;

        // Test 6: No BIC
        const test6 = `BCD
002
1
SCT

Test Company d.o.o.
SI56020313671566113
5.00
EUR

TS-2025-045
Invoice TS-2025-045`;

        // Generate QR codes
        function generateQRCode(text, elementId) {
            fetch('/api/generate-qr', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token"]')?.getAttribute('content') || ''
                },
                body: JSON.stringify({ text: text })
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.text(); // Get as text first
            })
            .then(text => {
                try {
                    const data = JSON.parse(text);
                    if (data.success) {
                        document.getElementById(elementId).innerHTML = `<img src="data:image/svg+xml;base64,${data.qr_code}" style="max-width: 200px;" />`;
                    } else {
                        document.getElementById(elementId).innerHTML = `<p style="color: red;">Error: ${data.error}</p>`;
                    }
                } catch (e) {
                    document.getElementById(elementId).innerHTML = `<p style="color: red;">JSON Parse Error: ${e.message}<br>Response: ${text.substring(0, 200)}...</p>`;
                }
            })
            .catch(error => {
                document.getElementById(elementId).innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
            });
        }

        // Generate all QR codes
        generateQRCode(test1, 'qr1');
        generateQRCode(test2, 'qr2');
        generateQRCode(test3, 'qr3');
        generateQRCode(test4, 'qr4');
        generateQRCode(test5, 'qr5');
        generateQRCode(test6, 'qr6');
    </script>
</body>
</html>
